var rn=Object.defineProperty;var on=(e,t,n)=>t in e?rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var j=(e,t,n)=>on(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();class an{constructor(t){j(this,"nodes");j(this,"edges");j(this,"edgesFromNode");j(this,"edgesToNode");var n,i;this.nodes=new Map,this.edges=new Map,this.edgesFromNode=new Map,this.edgesToNode=new Map;for(const s of t.nodes)this.nodes.set(s.id,s),this.edgesFromNode.set(s.id,[]),this.edgesToNode.set(s.id,[]);for(const s of t.edges)this.edges.set(s.id,s),(n=this.edgesFromNode.get(s.source))==null||n.push(s),(i=this.edgesToNode.get(s.target))==null||i.push(s)}getNode(t){return this.nodes.get(t)??null}getNodesByType(t){const n=[];for(const i of this.nodes.values())i.type===t&&n.push(i);return n}getEdgesFrom(t,n){const i=this.edgesFromNode.get(t)??[];return n?i.filter(s=>s.type===n):i}getEdgesTo(t,n){const i=this.edgesToNode.get(t)??[];return n?i.filter(s=>s.type===n):i}getNeighbours(t,n=1){const i=new Set([t]);let s=new Set([t]);for(let o=0;o<n;o++){const a=new Set;for(const c of s){for(const l of this.getEdgesFrom(c))i.has(l.target)||(i.add(l.target),a.add(l.target));for(const l of this.getEdgesTo(c))i.has(l.source)||(i.add(l.source),a.add(l.source))}s=a}i.delete(t);const r=[];for(const o of i){const a=this.nodes.get(o);a&&r.push(a)}return r}getEdgesByType(t){const n=[];for(const i of this.edges.values())i.type===t&&n.push(i);return n}getAllNodes(){return Array.from(this.nodes.values())}getAllEdges(){return Array.from(this.edges.values())}getEdgeBetween(t,n,i){const s=this.edgesFromNode.get(t)??[];for(const r of s)if(r.target===n&&(!i||r.type===i))return r;return null}}function ct(){return{mode:"BROWSE",selectedNodeId:null,refocusNodeId:null,activePreset:null,presetParam:null,matrixView:null,pinnedNodeIds:[],breadcrumb:[],visibleEntityTypes:new Set(["problem","mechanism","model","meta_challenge","foundation","implication","claim","source","cluster"]),clusterFilter:null,viewport:{x:0,y:0,zoom:1},escapeStack:[],searchOpen:!1,hoveredNodeId:null}}class cn{constructor(){j(this,"state");j(this,"listeners");this.state=ct(),this.listeners=new Map}getState(){return this.state}subscribe(t,n){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(n),()=>{var i;(i=this.listeners.get(t))==null||i.delete(n)}}emit(t){const n=this.listeners.get(t);if(n)for(const s of n)s(this.state);const i=this.listeners.get("*");if(i)for(const s of i)s(this.state)}pushEscape(t){this.state.escapeStack=[...this.state.escapeStack,t]}popEscape(){const t=[...this.state.escapeStack],n=t.pop();return this.state.escapeStack=t,n}selectNode(t){this.state.selectedNodeId=t,this.state.mode="DETAIL",this.state.escapeStack=this.state.escapeStack.filter(n=>n.type!=="close_detail"),this.pushEscape({type:"close_detail"}),this.emit("node:selected"),this.emit("mode:changed")}deselectNode(){this.state.selectedNodeId=null,this.state.mode="BROWSE",this.state.escapeStack=this.state.escapeStack.filter(t=>t.type!=="close_detail"),this.emit("node:deselected"),this.emit("mode:changed")}activatePreset(t,n){this.state.escapeStack=this.state.escapeStack.filter(i=>i.type!=="clear_preset"),this.state.activePreset=t,this.state.presetParam=n??null,this.pushEscape({type:"clear_preset"}),this.emit("preset:activated")}clearPreset(){this.state.activePreset=null,this.state.presetParam=null,this.state.escapeStack=this.state.escapeStack.filter(t=>t.type!=="clear_preset"),this.emit("preset:cleared")}hoverNode(t){this.state.hoveredNodeId=t,this.emit("node:hovered")}unhoverNode(){this.state.hoveredNodeId=null,this.emit("node:unhovered")}toggleSearch(){this.state.searchOpen=!this.state.searchOpen,this.state.searchOpen?this.pushEscape({type:"close_search"}):this.state.escapeStack=this.state.escapeStack.filter(t=>t.type!=="close_search"),this.emit("search:toggled")}updateViewport(t,n,i){this.state.viewport={x:t,y:n,zoom:i},this.emit("viewport:changed")}escape(){const t=this.popEscape();if(t)switch(t.type){case"close_search":this.state.searchOpen=!1,this.emit("search:toggled");break;case"close_detail":this.state.selectedNodeId=null,this.state.mode="BROWSE",this.emit("node:deselected"),this.emit("mode:changed");break;case"clear_preset":this.state.activePreset=null,this.state.presetParam=null,this.emit("preset:cleared");break;case"close_matrix":this.state.matrixView=null;break;case"exit_refocus":this.state.refocusNodeId=null,this.state.mode=this.state.selectedNodeId?"DETAIL":"BROWSE",this.emit("mode:changed");break}}reset(){const t=ct();this.state.mode=t.mode,this.state.selectedNodeId=t.selectedNodeId,this.state.refocusNodeId=t.refocusNodeId,this.state.activePreset=t.activePreset,this.state.presetParam=t.presetParam,this.state.matrixView=t.matrixView,this.state.escapeStack=t.escapeStack,this.state.searchOpen=t.searchOpen,this.state.hoveredNodeId=t.hoveredNodeId,this.emit("node:deselected"),this.emit("preset:cleared"),this.emit("mode:changed"),this.emit("search:toggled")}}var ln={value:()=>{}};function et(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Se(n)}function Se(e){this._=e}function dn(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",s=n.indexOf(".");if(s>=0&&(i=n.slice(s+1),n=n.slice(0,s)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Se.prototype=et.prototype={constructor:Se,on:function(e,t){var n=this._,i=dn(e+"",n),s,r=-1,o=i.length;if(arguments.length<2){for(;++r<o;)if((s=(e=i[r]).type)&&(s=un(n[s],e.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++r<o;)if(s=(e=i[r]).type)n[s]=lt(n[s],e.name,t);else if(t==null)for(s in n)n[s]=lt(n[s],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Se(e)},call:function(e,t){if((s=arguments.length-2)>0)for(var n=new Array(s),i=0,s,r;i<s;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],s=0,r=i.length;s<r;++s)i[s].value.apply(t,n)}};function un(e,t){for(var n=0,i=e.length,s;n<i;++n)if((s=e[n]).name===t)return s.value}function lt(e,t,n){for(var i=0,s=e.length;i<s;++i)if(e[i].name===t){e[i]=ln,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var Ye="http://www.w3.org/1999/xhtml";const dt={svg:"http://www.w3.org/2000/svg",xhtml:Ye,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function De(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),dt.hasOwnProperty(t)?{space:dt[t],local:e}:e}function fn(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Ye&&t.documentElement.namespaceURI===Ye?t.createElement(e):t.createElementNS(n,e)}}function hn(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Mt(e){var t=De(e);return(t.local?hn:fn)(t)}function pn(){}function tt(e){return e==null?pn:function(){return this.querySelector(e)}}function mn(e){typeof e!="function"&&(e=tt(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var r=t[s],o=r.length,a=i[s]=new Array(o),c,l,d=0;d<o;++d)(c=r[d])&&(l=e.call(c,c.__data__,d,r))&&("__data__"in c&&(l.__data__=c.__data__),a[d]=l);return new R(i,this._parents)}function gn(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function yn(){return[]}function Tt(e){return e==null?yn:function(){return this.querySelectorAll(e)}}function vn(e){return function(){return gn(e.apply(this,arguments))}}function bn(e){typeof e=="function"?e=vn(e):e=Tt(e);for(var t=this._groups,n=t.length,i=[],s=[],r=0;r<n;++r)for(var o=t[r],a=o.length,c,l=0;l<a;++l)(c=o[l])&&(i.push(e.call(c,c.__data__,l,o)),s.push(c));return new R(i,s)}function At(e){return function(){return this.matches(e)}}function Lt(e){return function(t){return t.matches(e)}}var xn=Array.prototype.find;function _n(e){return function(){return xn.call(this.children,e)}}function wn(){return this.firstElementChild}function Cn(e){return this.select(e==null?wn:_n(typeof e=="function"?e:Lt(e)))}var En=Array.prototype.filter;function Nn(){return Array.from(this.children)}function Sn(e){return function(){return En.call(this.children,e)}}function kn(e){return this.selectAll(e==null?Nn:Sn(typeof e=="function"?e:Lt(e)))}function Mn(e){typeof e!="function"&&(e=At(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var r=t[s],o=r.length,a=i[s]=[],c,l=0;l<o;++l)(c=r[l])&&e.call(c,c.__data__,l,r)&&a.push(c);return new R(i,this._parents)}function $t(e){return new Array(e.length)}function Tn(){return new R(this._enter||this._groups.map($t),this._parents)}function Ae(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Ae.prototype={constructor:Ae,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function An(e){return function(){return e}}function Ln(e,t,n,i,s,r){for(var o=0,a,c=t.length,l=r.length;o<l;++o)(a=t[o])?(a.__data__=r[o],i[o]=a):n[o]=new Ae(e,r[o]);for(;o<c;++o)(a=t[o])&&(s[o]=a)}function $n(e,t,n,i,s,r,o){var a,c,l=new Map,d=t.length,h=r.length,u=new Array(d),f;for(a=0;a<d;++a)(c=t[a])&&(u[a]=f=o.call(c,c.__data__,a,t)+"",l.has(f)?s[a]=c:l.set(f,c));for(a=0;a<h;++a)f=o.call(e,r[a],a,r)+"",(c=l.get(f))?(i[a]=c,c.__data__=r[a],l.delete(f)):n[a]=new Ae(e,r[a]);for(a=0;a<d;++a)(c=t[a])&&l.get(u[a])===c&&(s[a]=c)}function In(e){return e.__data__}function Bn(e,t){if(!arguments.length)return Array.from(this,In);var n=t?$n:Ln,i=this._parents,s=this._groups;typeof e!="function"&&(e=An(e));for(var r=s.length,o=new Array(r),a=new Array(r),c=new Array(r),l=0;l<r;++l){var d=i[l],h=s[l],u=h.length,f=Pn(e.call(d,d&&d.__data__,l,i)),m=f.length,g=a[l]=new Array(m),y=o[l]=new Array(m),v=c[l]=new Array(u);n(d,h,g,y,v,f,t);for(var w=0,k=0,L,P;w<m;++w)if(L=g[w]){for(w>=k&&(k=w+1);!(P=y[k])&&++k<m;);L._next=P||null}}return o=new R(o,i),o._enter=a,o._exit=c,o}function Pn(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Dn(){return new R(this._exit||this._groups.map($t),this._parents)}function Fn(e,t,n){var i=this.enter(),s=this,r=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(s=t(s),s&&(s=s.selection())),n==null?r.remove():n(r),i&&s?i.merge(s).order():s}function Rn(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,s=n.length,r=i.length,o=Math.min(s,r),a=new Array(s),c=0;c<o;++c)for(var l=n[c],d=i[c],h=l.length,u=a[c]=new Array(h),f,m=0;m<h;++m)(f=l[m]||d[m])&&(u[m]=f);for(;c<s;++c)a[c]=n[c];return new R(a,this._parents)}function zn(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],s=i.length-1,r=i[s],o;--s>=0;)(o=i[s])&&(r&&o.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(o,r),r=o);return this}function Hn(e){e||(e=On);function t(h,u){return h&&u?e(h.__data__,u.__data__):!h-!u}for(var n=this._groups,i=n.length,s=new Array(i),r=0;r<i;++r){for(var o=n[r],a=o.length,c=s[r]=new Array(a),l,d=0;d<a;++d)(l=o[d])&&(c[d]=l);c.sort(t)}return new R(s,this._parents).order()}function On(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function qn(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Xn(){return Array.from(this)}function Vn(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],s=0,r=i.length;s<r;++s){var o=i[s];if(o)return o}return null}function Yn(){let e=0;for(const t of this)++e;return e}function Gn(){return!this.node()}function Wn(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var s=t[n],r=0,o=s.length,a;r<o;++r)(a=s[r])&&e.call(a,a.__data__,r,s);return this}function Un(e){return function(){this.removeAttribute(e)}}function Kn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Qn(e,t){return function(){this.setAttribute(e,t)}}function Zn(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Jn(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function jn(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function ei(e,t){var n=De(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?Kn:Un:typeof t=="function"?n.local?jn:Jn:n.local?Zn:Qn)(n,t))}function It(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ti(e){return function(){this.style.removeProperty(e)}}function ni(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ii(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function si(e,t,n){return arguments.length>1?this.each((t==null?ti:typeof t=="function"?ii:ni)(e,t,n??"")):oe(this.node(),e)}function oe(e,t){return e.style.getPropertyValue(t)||It(e).getComputedStyle(e,null).getPropertyValue(t)}function ri(e){return function(){delete this[e]}}function oi(e,t){return function(){this[e]=t}}function ai(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function ci(e,t){return arguments.length>1?this.each((t==null?ri:typeof t=="function"?ai:oi)(e,t)):this.node()[e]}function Bt(e){return e.trim().split(/^|\s+/)}function nt(e){return e.classList||new Pt(e)}function Pt(e){this._node=e,this._names=Bt(e.getAttribute("class")||"")}Pt.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Dt(e,t){for(var n=nt(e),i=-1,s=t.length;++i<s;)n.add(t[i])}function Ft(e,t){for(var n=nt(e),i=-1,s=t.length;++i<s;)n.remove(t[i])}function li(e){return function(){Dt(this,e)}}function di(e){return function(){Ft(this,e)}}function ui(e,t){return function(){(t.apply(this,arguments)?Dt:Ft)(this,e)}}function fi(e,t){var n=Bt(e+"");if(arguments.length<2){for(var i=nt(this.node()),s=-1,r=n.length;++s<r;)if(!i.contains(n[s]))return!1;return!0}return this.each((typeof t=="function"?ui:t?li:di)(n,t))}function hi(){this.textContent=""}function pi(e){return function(){this.textContent=e}}function mi(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function gi(e){return arguments.length?this.each(e==null?hi:(typeof e=="function"?mi:pi)(e)):this.node().textContent}function yi(){this.innerHTML=""}function vi(e){return function(){this.innerHTML=e}}function bi(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function xi(e){return arguments.length?this.each(e==null?yi:(typeof e=="function"?bi:vi)(e)):this.node().innerHTML}function _i(){this.nextSibling&&this.parentNode.appendChild(this)}function wi(){return this.each(_i)}function Ci(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ei(){return this.each(Ci)}function Ni(e){var t=typeof e=="function"?e:Mt(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Si(){return null}function ki(e,t){var n=typeof e=="function"?e:Mt(e),i=t==null?Si:typeof t=="function"?t:tt(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Mi(){var e=this.parentNode;e&&e.removeChild(this)}function Ti(){return this.each(Mi)}function Ai(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Li(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $i(e){return this.select(e?Li:Ai)}function Ii(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Bi(e){return function(t){e.call(this,t,this.__data__)}}function Pi(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Di(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,s=t.length,r;n<s;++n)r=t[n],(!e.type||r.type===e.type)&&r.name===e.name?this.removeEventListener(r.type,r.listener,r.options):t[++i]=r;++i?t.length=i:delete this.__on}}}function Fi(e,t,n){return function(){var i=this.__on,s,r=Bi(t);if(i){for(var o=0,a=i.length;o<a;++o)if((s=i[o]).type===e.type&&s.name===e.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=r,s.options=n),s.value=t;return}}this.addEventListener(e.type,r,n),s={type:e.type,name:e.name,value:t,listener:r,options:n},i?i.push(s):this.__on=[s]}}function Ri(e,t,n){var i=Pi(e+""),s,r=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,d;c<l;++c)for(s=0,d=a[c];s<r;++s)if((o=i[s]).type===d.type&&o.name===d.name)return d.value}return}for(a=t?Fi:Di,s=0;s<r;++s)this.each(a(i[s],t,n));return this}function Rt(e,t,n){var i=It(e),s=i.CustomEvent;typeof s=="function"?s=new s(t,n):(s=i.document.createEvent("Event"),n?(s.initEvent(t,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(t,!1,!1)),e.dispatchEvent(s)}function zi(e,t){return function(){return Rt(this,e,t)}}function Hi(e,t){return function(){return Rt(this,e,t.apply(this,arguments))}}function Oi(e,t){return this.each((typeof t=="function"?Hi:zi)(e,t))}function*qi(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],s=0,r=i.length,o;s<r;++s)(o=i[s])&&(yield o)}var zt=[null];function R(e,t){this._groups=e,this._parents=t}function ye(){return new R([[document.documentElement]],zt)}function Xi(){return this}R.prototype=ye.prototype={constructor:R,select:mn,selectAll:bn,selectChild:Cn,selectChildren:kn,filter:Mn,data:Bn,enter:Tn,exit:Dn,join:Fn,merge:Rn,selection:Xi,order:zn,sort:Hn,call:qn,nodes:Xn,node:Vn,size:Yn,empty:Gn,each:Wn,attr:ei,style:si,property:ci,classed:fi,text:gi,html:xi,raise:wi,lower:Ei,append:Ni,insert:ki,remove:Ti,clone:$i,datum:Ii,on:Ri,dispatch:Oi,[Symbol.iterator]:qi};function B(e){return typeof e=="string"?new R([[document.querySelector(e)]],[document.documentElement]):new R([[e]],zt)}function Vi(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ee(e,t){if(e=Vi(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}}return[e.pageX,e.pageY]}const Ge={capture:!0,passive:!1};function We(e){e.preventDefault(),e.stopImmediatePropagation()}function Yi(e){var t=e.document.documentElement,n=B(e).on("dragstart.drag",We,Ge);"onselectstart"in t?n.on("selectstart.drag",We,Ge):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Gi(e,t){var n=e.document.documentElement,i=B(e).on("dragstart.drag",null);t&&(i.on("click.drag",We,Ge),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function it(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ht(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function ve(){}var he=.7,Le=1/he,re="\\s*([+-]?\\d+)\\s*",pe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",V="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wi=/^#([0-9a-f]{3,8})$/,Ui=new RegExp(`^rgb\\(${re},${re},${re}\\)$`),Ki=new RegExp(`^rgb\\(${V},${V},${V}\\)$`),Qi=new RegExp(`^rgba\\(${re},${re},${re},${pe}\\)$`),Zi=new RegExp(`^rgba\\(${V},${V},${V},${pe}\\)$`),Ji=new RegExp(`^hsl\\(${pe},${V},${V}\\)$`),ji=new RegExp(`^hsla\\(${pe},${V},${V},${pe}\\)$`),ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};it(ve,me,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ft,formatHex:ft,formatHex8:es,formatHsl:ts,formatRgb:ht,toString:ht});function ft(){return this.rgb().formatHex()}function es(){return this.rgb().formatHex8()}function ts(){return Ot(this).formatHsl()}function ht(){return this.rgb().formatRgb()}function me(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Wi.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?pt(t):n===3?new F(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?we(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?we(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ui.exec(e))?new F(t[1],t[2],t[3],1):(t=Ki.exec(e))?new F(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Qi.exec(e))?we(t[1],t[2],t[3],t[4]):(t=Zi.exec(e))?we(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ji.exec(e))?yt(t[1],t[2]/100,t[3]/100,1):(t=ji.exec(e))?yt(t[1],t[2]/100,t[3]/100,t[4]):ut.hasOwnProperty(e)?pt(ut[e]):e==="transparent"?new F(NaN,NaN,NaN,0):null}function pt(e){return new F(e>>16&255,e>>8&255,e&255,1)}function we(e,t,n,i){return i<=0&&(e=t=n=NaN),new F(e,t,n,i)}function ns(e){return e instanceof ve||(e=me(e)),e?(e=e.rgb(),new F(e.r,e.g,e.b,e.opacity)):new F}function Ue(e,t,n,i){return arguments.length===1?ns(e):new F(e,t,n,i??1)}function F(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}it(F,Ue,Ht(ve,{brighter(e){return e=e==null?Le:Math.pow(Le,e),new F(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?he:Math.pow(he,e),new F(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new F(ie(this.r),ie(this.g),ie(this.b),$e(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mt,formatHex:mt,formatHex8:is,formatRgb:gt,toString:gt}));function mt(){return`#${ne(this.r)}${ne(this.g)}${ne(this.b)}`}function is(){return`#${ne(this.r)}${ne(this.g)}${ne(this.b)}${ne((isNaN(this.opacity)?1:this.opacity)*255)}`}function gt(){const e=$e(this.opacity);return`${e===1?"rgb(":"rgba("}${ie(this.r)}, ${ie(this.g)}, ${ie(this.b)}${e===1?")":`, ${e})`}`}function $e(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ie(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ne(e){return e=ie(e),(e<16?"0":"")+e.toString(16)}function yt(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new O(e,t,n,i)}function Ot(e){if(e instanceof O)return new O(e.h,e.s,e.l,e.opacity);if(e instanceof ve||(e=me(e)),!e)return new O;if(e instanceof O)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,s=Math.min(t,n,i),r=Math.max(t,n,i),o=NaN,a=r-s,c=(r+s)/2;return a?(t===r?o=(n-i)/a+(n<i)*6:n===r?o=(i-t)/a+2:o=(t-n)/a+4,a/=c<.5?r+s:2-r-s,o*=60):a=c>0&&c<1?0:o,new O(o,a,c,e.opacity)}function ss(e,t,n,i){return arguments.length===1?Ot(e):new O(e,t,n,i??1)}function O(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}it(O,ss,Ht(ve,{brighter(e){return e=e==null?Le:Math.pow(Le,e),new O(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?he:Math.pow(he,e),new O(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,s=2*n-i;return new F(He(e>=240?e-240:e+120,s,i),He(e,s,i),He(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new O(vt(this.h),Ce(this.s),Ce(this.l),$e(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=$e(this.opacity);return`${e===1?"hsl(":"hsla("}${vt(this.h)}, ${Ce(this.s)*100}%, ${Ce(this.l)*100}%${e===1?")":`, ${e})`}`}}));function vt(e){return e=(e||0)%360,e<0?e+360:e}function Ce(e){return Math.max(0,Math.min(1,e||0))}function He(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const qt=e=>()=>e;function rs(e,t){return function(n){return e+n*t}}function os(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function as(e){return(e=+e)==1?Xt:function(t,n){return n-t?os(t,n,e):qt(isNaN(t)?n:t)}}function Xt(e,t){var n=t-e;return n?rs(e,n):qt(isNaN(e)?t:e)}const bt=function e(t){var n=as(t);function i(s,r){var o=n((s=Ue(s)).r,(r=Ue(r)).r),a=n(s.g,r.g),c=n(s.b,r.b),l=Xt(s.opacity,r.opacity);return function(d){return s.r=o(d),s.g=a(d),s.b=c(d),s.opacity=l(d),s+""}}return i.gamma=e,i}(1);function J(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Ke=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Oe=new RegExp(Ke.source,"g");function cs(e){return function(){return e}}function ls(e){return function(t){return e(t)+""}}function ds(e,t){var n=Ke.lastIndex=Oe.lastIndex=0,i,s,r,o=-1,a=[],c=[];for(e=e+"",t=t+"";(i=Ke.exec(e))&&(s=Oe.exec(t));)(r=s.index)>n&&(r=t.slice(n,r),a[o]?a[o]+=r:a[++o]=r),(i=i[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,c.push({i:o,x:J(i,s)})),n=Oe.lastIndex;return n<t.length&&(r=t.slice(n),a[o]?a[o]+=r:a[++o]=r),a.length<2?c[0]?ls(c[0].x):cs(t):(t=c.length,function(l){for(var d=0,h;d<t;++d)a[(h=c[d]).i]=h.x(l);return a.join("")})}var xt=180/Math.PI,Qe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vt(e,t,n,i,s,r){var o,a,c;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(c=e*n+t*i)&&(n-=e*c,i-=t*c),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,c/=a),e*i<t*n&&(e=-e,t=-t,c=-c,o=-o),{translateX:s,translateY:r,rotate:Math.atan2(t,e)*xt,skewX:Math.atan(c)*xt,scaleX:o,scaleY:a}}var Ee;function us(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Qe:Vt(t.a,t.b,t.c,t.d,t.e,t.f)}function fs(e){return e==null||(Ee||(Ee=document.createElementNS("http://www.w3.org/2000/svg","g")),Ee.setAttribute("transform",e),!(e=Ee.transform.baseVal.consolidate()))?Qe:(e=e.matrix,Vt(e.a,e.b,e.c,e.d,e.e,e.f))}function Yt(e,t,n,i){function s(l){return l.length?l.pop()+" ":""}function r(l,d,h,u,f,m){if(l!==h||d!==u){var g=f.push("translate(",null,t,null,n);m.push({i:g-4,x:J(l,h)},{i:g-2,x:J(d,u)})}else(h||u)&&f.push("translate("+h+t+u+n)}function o(l,d,h,u){l!==d?(l-d>180?d+=360:d-l>180&&(l+=360),u.push({i:h.push(s(h)+"rotate(",null,i)-2,x:J(l,d)})):d&&h.push(s(h)+"rotate("+d+i)}function a(l,d,h,u){l!==d?u.push({i:h.push(s(h)+"skewX(",null,i)-2,x:J(l,d)}):d&&h.push(s(h)+"skewX("+d+i)}function c(l,d,h,u,f,m){if(l!==h||d!==u){var g=f.push(s(f)+"scale(",null,",",null,")");m.push({i:g-4,x:J(l,h)},{i:g-2,x:J(d,u)})}else(h!==1||u!==1)&&f.push(s(f)+"scale("+h+","+u+")")}return function(l,d){var h=[],u=[];return l=e(l),d=e(d),r(l.translateX,l.translateY,d.translateX,d.translateY,h,u),o(l.rotate,d.rotate,h,u),a(l.skewX,d.skewX,h,u),c(l.scaleX,l.scaleY,d.scaleX,d.scaleY,h,u),l=d=null,function(f){for(var m=-1,g=u.length,y;++m<g;)h[(y=u[m]).i]=y.x(f);return h.join("")}}}var hs=Yt(us,"px, ","px)","deg)"),ps=Yt(fs,", ",")",")"),ms=1e-12;function _t(e){return((e=Math.exp(e))+1/e)/2}function gs(e){return((e=Math.exp(e))-1/e)/2}function ys(e){return((e=Math.exp(2*e))-1)/(e+1)}const vs=function e(t,n,i){function s(r,o){var a=r[0],c=r[1],l=r[2],d=o[0],h=o[1],u=o[2],f=d-a,m=h-c,g=f*f+m*m,y,v;if(g<ms)v=Math.log(u/l)/t,y=function(Z){return[a+Z*f,c+Z*m,l*Math.exp(t*Z*v)]};else{var w=Math.sqrt(g),k=(u*u-l*l+i*g)/(2*l*n*w),L=(u*u-l*l-i*g)/(2*u*n*w),P=Math.log(Math.sqrt(k*k+1)-k),I=Math.log(Math.sqrt(L*L+1)-L);v=(I-P)/t,y=function(Z){var be=Z*v,xe=_t(P),_e=l/(n*w)*(xe*ys(t*be+P)-gs(P));return[a+_e*f,c+_e*m,l*xe/_t(t*be+P)]}}return y.duration=v*1e3*t/Math.SQRT2,y}return s.rho=function(r){var o=Math.max(.001,+r),a=o*o,c=a*a;return e(o,a,c)},s}(Math.SQRT2,2,4);var ae=0,ue=0,ce=0,Gt=1e3,Ie,fe,Be=0,se=0,Fe=0,ge=typeof performance=="object"&&performance.now?performance:Date,Wt=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function st(){return se||(Wt(bs),se=ge.now()+Fe)}function bs(){se=0}function Pe(){this._call=this._time=this._next=null}Pe.prototype=Ut.prototype={constructor:Pe,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?st():+n)+(t==null?0:+t),!this._next&&fe!==this&&(fe?fe._next=this:Ie=this,fe=this),this._call=e,this._time=n,Ze()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ze())}};function Ut(e,t,n){var i=new Pe;return i.restart(e,t,n),i}function xs(){st(),++ae;for(var e=Ie,t;e;)(t=se-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ae}function wt(){se=(Be=ge.now())+Fe,ae=ue=0;try{xs()}finally{ae=0,ws(),se=0}}function _s(){var e=ge.now(),t=e-Be;t>Gt&&(Fe-=t,Be=e)}function ws(){for(var e,t=Ie,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Ie=n);fe=e,Ze(i)}function Ze(e){if(!ae){ue&&(ue=clearTimeout(ue));var t=e-se;t>24?(e<1/0&&(ue=setTimeout(wt,e-ge.now()-Fe)),ce&&(ce=clearInterval(ce))):(ce||(Be=ge.now(),ce=setInterval(_s,Gt)),ae=1,Wt(wt))}}function Ct(e,t,n){var i=new Pe;return t=t==null?0:+t,i.restart(s=>{i.stop(),e(s+t)},t,n),i}var Cs=et("start","end","cancel","interrupt"),Es=[],Kt=0,Et=1,Je=2,ke=3,Nt=4,je=5,Me=6;function Re(e,t,n,i,s,r){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;Ns(e,n,{name:t,index:i,group:s,on:Cs,tween:Es,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:Kt})}function rt(e,t){var n=q(e,t);if(n.state>Kt)throw new Error("too late; already scheduled");return n}function Y(e,t){var n=q(e,t);if(n.state>ke)throw new Error("too late; already running");return n}function q(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ns(e,t,n){var i=e.__transition,s;i[t]=n,n.timer=Ut(r,0,n.time);function r(l){n.state=Et,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var d,h,u,f;if(n.state!==Et)return c();for(d in i)if(f=i[d],f.name===n.name){if(f.state===ke)return Ct(o);f.state===Nt?(f.state=Me,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete i[d]):+d<t&&(f.state=Me,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete i[d])}if(Ct(function(){n.state===ke&&(n.state=Nt,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=Je,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Je){for(n.state=ke,s=new Array(u=n.tween.length),d=0,h=-1;d<u;++d)(f=n.tween[d].value.call(e,e.__data__,n.index,n.group))&&(s[++h]=f);s.length=h+1}}function a(l){for(var d=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=je,1),h=-1,u=s.length;++h<u;)s[h].call(e,d);n.state===je&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Me,n.timer.stop(),delete i[t];for(var l in i)return;delete e.__transition}}function Te(e,t){var n=e.__transition,i,s,r=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){r=!1;continue}s=i.state>Je&&i.state<je,i.state=Me,i.timer.stop(),i.on.call(s?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}r&&delete e.__transition}}function Ss(e){return this.each(function(){Te(this,e)})}function ks(e,t){var n,i;return function(){var s=Y(this,e),r=s.tween;if(r!==n){i=n=r;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}s.tween=i}}function Ms(e,t,n){var i,s;if(typeof n!="function")throw new Error;return function(){var r=Y(this,e),o=r.tween;if(o!==i){s=(i=o).slice();for(var a={name:t,value:n},c=0,l=s.length;c<l;++c)if(s[c].name===t){s[c]=a;break}c===l&&s.push(a)}r.tween=s}}function Ts(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=q(this.node(),n).tween,s=0,r=i.length,o;s<r;++s)if((o=i[s]).name===e)return o.value;return null}return this.each((t==null?ks:Ms)(n,e,t))}function ot(e,t,n){var i=e._id;return e.each(function(){var s=Y(this,i);(s.value||(s.value={}))[t]=n.apply(this,arguments)}),function(s){return q(s,i).value[t]}}function Qt(e,t){var n;return(typeof t=="number"?J:t instanceof me?bt:(n=me(t))?(t=n,bt):ds)(e,t)}function As(e){return function(){this.removeAttribute(e)}}function Ls(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $s(e,t,n){var i,s=n+"",r;return function(){var o=this.getAttribute(e);return o===s?null:o===i?r:r=t(i=o,n)}}function Is(e,t,n){var i,s=n+"",r;return function(){var o=this.getAttributeNS(e.space,e.local);return o===s?null:o===i?r:r=t(i=o,n)}}function Bs(e,t,n){var i,s,r;return function(){var o,a=n(this),c;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),c=a+"",o===c?null:o===i&&c===s?r:(s=c,r=t(i=o,a)))}}function Ps(e,t,n){var i,s,r;return function(){var o,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),c=a+"",o===c?null:o===i&&c===s?r:(s=c,r=t(i=o,a)))}}function Ds(e,t){var n=De(e),i=n==="transform"?ps:Qt;return this.attrTween(e,typeof t=="function"?(n.local?Ps:Bs)(n,i,ot(this,"attr."+e,t)):t==null?(n.local?Ls:As)(n):(n.local?Is:$s)(n,i,t))}function Fs(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Rs(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function zs(e,t){var n,i;function s(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&Rs(e,r)),n}return s._value=t,s}function Hs(e,t){var n,i;function s(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&Fs(e,r)),n}return s._value=t,s}function Os(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=De(e);return this.tween(n,(i.local?zs:Hs)(i,t))}function qs(e,t){return function(){rt(this,e).delay=+t.apply(this,arguments)}}function Xs(e,t){return t=+t,function(){rt(this,e).delay=t}}function Vs(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?qs:Xs)(t,e)):q(this.node(),t).delay}function Ys(e,t){return function(){Y(this,e).duration=+t.apply(this,arguments)}}function Gs(e,t){return t=+t,function(){Y(this,e).duration=t}}function Ws(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ys:Gs)(t,e)):q(this.node(),t).duration}function Us(e,t){if(typeof t!="function")throw new Error;return function(){Y(this,e).ease=t}}function Ks(e){var t=this._id;return arguments.length?this.each(Us(t,e)):q(this.node(),t).ease}function Qs(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Y(this,e).ease=n}}function Zs(e){if(typeof e!="function")throw new Error;return this.each(Qs(this._id,e))}function Js(e){typeof e!="function"&&(e=At(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var r=t[s],o=r.length,a=i[s]=[],c,l=0;l<o;++l)(c=r[l])&&e.call(c,c.__data__,l,r)&&a.push(c);return new Q(i,this._parents,this._name,this._id)}function js(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,s=n.length,r=Math.min(i,s),o=new Array(i),a=0;a<r;++a)for(var c=t[a],l=n[a],d=c.length,h=o[a]=new Array(d),u,f=0;f<d;++f)(u=c[f]||l[f])&&(h[f]=u);for(;a<i;++a)o[a]=t[a];return new Q(o,this._parents,this._name,this._id)}function er(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function tr(e,t,n){var i,s,r=er(t)?rt:Y;return function(){var o=r(this,e),a=o.on;a!==i&&(s=(i=a).copy()).on(t,n),o.on=s}}function nr(e,t){var n=this._id;return arguments.length<2?q(this.node(),n).on.on(e):this.each(tr(n,e,t))}function ir(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function sr(){return this.on("end.remove",ir(this._id))}function rr(e){var t=this._name,n=this._id;typeof e!="function"&&(e=tt(e));for(var i=this._groups,s=i.length,r=new Array(s),o=0;o<s;++o)for(var a=i[o],c=a.length,l=r[o]=new Array(c),d,h,u=0;u<c;++u)(d=a[u])&&(h=e.call(d,d.__data__,u,a))&&("__data__"in d&&(h.__data__=d.__data__),l[u]=h,Re(l[u],t,n,u,l,q(d,n)));return new Q(r,this._parents,t,n)}function or(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Tt(e));for(var i=this._groups,s=i.length,r=[],o=[],a=0;a<s;++a)for(var c=i[a],l=c.length,d,h=0;h<l;++h)if(d=c[h]){for(var u=e.call(d,d.__data__,h,c),f,m=q(d,n),g=0,y=u.length;g<y;++g)(f=u[g])&&Re(f,t,n,g,u,m);r.push(u),o.push(d)}return new Q(r,o,t,n)}var ar=ye.prototype.constructor;function cr(){return new ar(this._groups,this._parents)}function lr(e,t){var n,i,s;return function(){var r=oe(this,e),o=(this.style.removeProperty(e),oe(this,e));return r===o?null:r===n&&o===i?s:s=t(n=r,i=o)}}function Zt(e){return function(){this.style.removeProperty(e)}}function dr(e,t,n){var i,s=n+"",r;return function(){var o=oe(this,e);return o===s?null:o===i?r:r=t(i=o,n)}}function ur(e,t,n){var i,s,r;return function(){var o=oe(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),oe(this,e))),o===c?null:o===i&&c===s?r:(s=c,r=t(i=o,a))}}function fr(e,t){var n,i,s,r="style."+t,o="end."+r,a;return function(){var c=Y(this,e),l=c.on,d=c.value[r]==null?a||(a=Zt(t)):void 0;(l!==n||s!==d)&&(i=(n=l).copy()).on(o,s=d),c.on=i}}function hr(e,t,n){var i=(e+="")=="transform"?hs:Qt;return t==null?this.styleTween(e,lr(e,i)).on("end.style."+e,Zt(e)):typeof t=="function"?this.styleTween(e,ur(e,i,ot(this,"style."+e,t))).each(fr(this._id,e)):this.styleTween(e,dr(e,i,t),n).on("end.style."+e,null)}function pr(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function mr(e,t,n){var i,s;function r(){var o=t.apply(this,arguments);return o!==s&&(i=(s=o)&&pr(e,o,n)),i}return r._value=t,r}function gr(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,mr(e,t,n??""))}function yr(e){return function(){this.textContent=e}}function vr(e){return function(){var t=e(this);this.textContent=t??""}}function br(e){return this.tween("text",typeof e=="function"?vr(ot(this,"text",e)):yr(e==null?"":e+""))}function xr(e){return function(t){this.textContent=e.call(this,t)}}function _r(e){var t,n;function i(){var s=e.apply(this,arguments);return s!==n&&(t=(n=s)&&xr(s)),t}return i._value=e,i}function wr(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,_r(e))}function Cr(){for(var e=this._name,t=this._id,n=Jt(),i=this._groups,s=i.length,r=0;r<s;++r)for(var o=i[r],a=o.length,c,l=0;l<a;++l)if(c=o[l]){var d=q(c,t);Re(c,e,n,l,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Q(i,this._parents,e,n)}function Er(){var e,t,n=this,i=n._id,s=n.size();return new Promise(function(r,o){var a={value:o},c={value:function(){--s===0&&r()}};n.each(function(){var l=Y(this,i),d=l.on;d!==e&&(t=(e=d).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),l.on=t}),s===0&&r()})}var Nr=0;function Q(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Jt(){return++Nr}var U=ye.prototype;Q.prototype={constructor:Q,select:rr,selectAll:or,selectChild:U.selectChild,selectChildren:U.selectChildren,filter:Js,merge:js,selection:cr,transition:Cr,call:U.call,nodes:U.nodes,node:U.node,size:U.size,empty:U.empty,each:U.each,on:nr,attr:Ds,attrTween:Os,style:hr,styleTween:gr,text:br,textTween:wr,remove:sr,tween:Ts,delay:Vs,duration:Ws,ease:Ks,easeVarying:Zs,end:Er,[Symbol.iterator]:U[Symbol.iterator]};function Sr(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var kr={time:null,delay:0,duration:250,ease:Sr};function Mr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Tr(e){var t,n;e instanceof Q?(t=e._id,e=e._name):(t=Jt(),(n=kr).time=st(),e=e==null?null:e+"");for(var i=this._groups,s=i.length,r=0;r<s;++r)for(var o=i[r],a=o.length,c,l=0;l<a;++l)(c=o[l])&&Re(c,e,t,l,o,n||Mr(c,t));return new Q(i,this._parents,e,t)}ye.prototype.interrupt=Ss;ye.prototype.transition=Tr;const Ne=e=>()=>e;function Ar(e,{sourceEvent:t,target:n,transform:i,dispatch:s}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function K(e,t,n){this.k=e,this.x=t,this.y=n}K.prototype={constructor:K,scale:function(e){return e===1?this:new K(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new K(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var at=new K(1,0,0);K.prototype;function qe(e){e.stopImmediatePropagation()}function le(e){e.preventDefault(),e.stopImmediatePropagation()}function Lr(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function $r(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function St(){return this.__zoom||at}function Ir(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Br(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pr(e,t,n){var i=e.invertX(t[0][0])-n[0][0],s=e.invertX(t[1][0])-n[1][0],r=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s),o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o))}function Dr(){var e=Lr,t=$r,n=Pr,i=Ir,s=Br,r=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,c=vs,l=et("start","zoom","end"),d,h,u,f=500,m=150,g=0,y=10;function v(p){p.property("__zoom",St).on("wheel.zoom",be,{passive:!1}).on("mousedown.zoom",xe).on("dblclick.zoom",_e).filter(s).on("touchstart.zoom",tn).on("touchmove.zoom",nn).on("touchend.zoom touchcancel.zoom",sn).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(p,x,b,_){var C=p.selection?p.selection():p;C.property("__zoom",St),p!==C?P(p,x,b,_):C.interrupt().each(function(){I(this,arguments).event(_).start().zoom(null,typeof x=="function"?x.apply(this,arguments):x).end()})},v.scaleBy=function(p,x,b,_){v.scaleTo(p,function(){var C=this.__zoom.k,N=typeof x=="function"?x.apply(this,arguments):x;return C*N},b,_)},v.scaleTo=function(p,x,b,_){v.transform(p,function(){var C=t.apply(this,arguments),N=this.__zoom,S=b==null?L(C):typeof b=="function"?b.apply(this,arguments):b,M=N.invert(S),$=typeof x=="function"?x.apply(this,arguments):x;return n(k(w(N,$),S,M),C,o)},b,_)},v.translateBy=function(p,x,b,_){v.transform(p,function(){return n(this.__zoom.translate(typeof x=="function"?x.apply(this,arguments):x,typeof b=="function"?b.apply(this,arguments):b),t.apply(this,arguments),o)},null,_)},v.translateTo=function(p,x,b,_,C){v.transform(p,function(){var N=t.apply(this,arguments),S=this.__zoom,M=_==null?L(N):typeof _=="function"?_.apply(this,arguments):_;return n(at.translate(M[0],M[1]).scale(S.k).translate(typeof x=="function"?-x.apply(this,arguments):-x,typeof b=="function"?-b.apply(this,arguments):-b),N,o)},_,C)};function w(p,x){return x=Math.max(r[0],Math.min(r[1],x)),x===p.k?p:new K(x,p.x,p.y)}function k(p,x,b){var _=x[0]-b[0]*p.k,C=x[1]-b[1]*p.k;return _===p.x&&C===p.y?p:new K(p.k,_,C)}function L(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function P(p,x,b,_){p.on("start.zoom",function(){I(this,arguments).event(_).start()}).on("interrupt.zoom end.zoom",function(){I(this,arguments).event(_).end()}).tween("zoom",function(){var C=this,N=arguments,S=I(C,N).event(_),M=t.apply(C,N),$=b==null?L(M):typeof b=="function"?b.apply(C,N):b,X=Math.max(M[1][0]-M[0][0],M[1][1]-M[0][1]),D=C.__zoom,z=typeof x=="function"?x.apply(C,N):x,G=c(D.invert($).concat(X/D.k),z.invert($).concat(X/z.k));return function(H){if(H===1)H=z;else{var W=G(H),ze=X/W[2];H=new K(ze,$[0]-W[0]*ze,$[1]-W[1]*ze)}S.zoom(null,H)}})}function I(p,x,b){return!b&&p.__zooming||new Z(p,x)}function Z(p,x){this.that=p,this.args=x,this.active=0,this.sourceEvent=null,this.extent=t.apply(p,x),this.taps=0}Z.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,x){return this.mouse&&p!=="mouse"&&(this.mouse[1]=x.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=x.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=x.invert(this.touch1[0])),this.that.__zoom=x,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var x=B(this.that).datum();l.call(p,this.that,new Ar(p,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:l}),x)}};function be(p,...x){if(!e.apply(this,arguments))return;var b=I(this,x).event(p),_=this.__zoom,C=Math.max(r[0],Math.min(r[1],_.k*Math.pow(2,i.apply(this,arguments)))),N=ee(p);if(b.wheel)(b.mouse[0][0]!==N[0]||b.mouse[0][1]!==N[1])&&(b.mouse[1]=_.invert(b.mouse[0]=N)),clearTimeout(b.wheel);else{if(_.k===C)return;b.mouse=[N,_.invert(N)],Te(this),b.start()}le(p),b.wheel=setTimeout(S,m),b.zoom("mouse",n(k(w(_,C),b.mouse[0],b.mouse[1]),b.extent,o));function S(){b.wheel=null,b.end()}}function xe(p,...x){if(u||!e.apply(this,arguments))return;var b=p.currentTarget,_=I(this,x,!0).event(p),C=B(p.view).on("mousemove.zoom",$,!0).on("mouseup.zoom",X,!0),N=ee(p,b),S=p.clientX,M=p.clientY;Yi(p.view),qe(p),_.mouse=[N,this.__zoom.invert(N)],Te(this),_.start();function $(D){if(le(D),!_.moved){var z=D.clientX-S,G=D.clientY-M;_.moved=z*z+G*G>g}_.event(D).zoom("mouse",n(k(_.that.__zoom,_.mouse[0]=ee(D,b),_.mouse[1]),_.extent,o))}function X(D){C.on("mousemove.zoom mouseup.zoom",null),Gi(D.view,_.moved),le(D),_.event(D).end()}}function _e(p,...x){if(e.apply(this,arguments)){var b=this.__zoom,_=ee(p.changedTouches?p.changedTouches[0]:p,this),C=b.invert(_),N=b.k*(p.shiftKey?.5:2),S=n(k(w(b,N),_,C),t.apply(this,x),o);le(p),a>0?B(this).transition().duration(a).call(P,S,_,p):B(this).call(v.transform,S,_,p)}}function tn(p,...x){if(e.apply(this,arguments)){var b=p.touches,_=b.length,C=I(this,x,p.changedTouches.length===_).event(p),N,S,M,$;for(qe(p),S=0;S<_;++S)M=b[S],$=ee(M,this),$=[$,this.__zoom.invert($),M.identifier],C.touch0?!C.touch1&&C.touch0[2]!==$[2]&&(C.touch1=$,C.taps=0):(C.touch0=$,N=!0,C.taps=1+!!d);d&&(d=clearTimeout(d)),N&&(C.taps<2&&(h=$[0],d=setTimeout(function(){d=null},f)),Te(this),C.start())}}function nn(p,...x){if(this.__zooming){var b=I(this,x).event(p),_=p.changedTouches,C=_.length,N,S,M,$;for(le(p),N=0;N<C;++N)S=_[N],M=ee(S,this),b.touch0&&b.touch0[2]===S.identifier?b.touch0[0]=M:b.touch1&&b.touch1[2]===S.identifier&&(b.touch1[0]=M);if(S=b.that.__zoom,b.touch1){var X=b.touch0[0],D=b.touch0[1],z=b.touch1[0],G=b.touch1[1],H=(H=z[0]-X[0])*H+(H=z[1]-X[1])*H,W=(W=G[0]-D[0])*W+(W=G[1]-D[1])*W;S=w(S,Math.sqrt(H/W)),M=[(X[0]+z[0])/2,(X[1]+z[1])/2],$=[(D[0]+G[0])/2,(D[1]+G[1])/2]}else if(b.touch0)M=b.touch0[0],$=b.touch0[1];else return;b.zoom("touch",n(k(S,M,$),b.extent,o))}}function sn(p,...x){if(this.__zooming){var b=I(this,x).event(p),_=p.changedTouches,C=_.length,N,S;for(qe(p),u&&clearTimeout(u),u=setTimeout(function(){u=null},f),N=0;N<C;++N)S=_[N],b.touch0&&b.touch0[2]===S.identifier?delete b.touch0:b.touch1&&b.touch1[2]===S.identifier&&delete b.touch1;if(b.touch1&&!b.touch0&&(b.touch0=b.touch1,delete b.touch1),b.touch0)b.touch0[1]=this.__zoom.invert(b.touch0[0]);else if(b.end(),b.taps===2&&(S=ee(S,this),Math.hypot(h[0]-S[0],h[1]-S[1])<y)){var M=B(this).on("dblclick.zoom");M&&M.apply(this,arguments)}}}return v.wheelDelta=function(p){return arguments.length?(i=typeof p=="function"?p:Ne(+p),v):i},v.filter=function(p){return arguments.length?(e=typeof p=="function"?p:Ne(!!p),v):e},v.touchable=function(p){return arguments.length?(s=typeof p=="function"?p:Ne(!!p),v):s},v.extent=function(p){return arguments.length?(t=typeof p=="function"?p:Ne([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),v):t},v.scaleExtent=function(p){return arguments.length?(r[0]=+p[0],r[1]=+p[1],v):[r[0],r[1]]},v.translateExtent=function(p){return arguments.length?(o[0][0]=+p[0][0],o[1][0]=+p[1][0],o[0][1]=+p[0][1],o[1][1]=+p[1][1],v):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},v.constrain=function(p){return arguments.length?(n=p,v):n},v.duration=function(p){return arguments.length?(a=+p,v):a},v.interpolate=function(p){return arguments.length?(c=p,v):c},v.on=function(){var p=l.on.apply(l,arguments);return p===l?v:p},v.clickDistance=function(p){return arguments.length?(g=(p=+p)*p,v):Math.sqrt(g)},v.tapDistance=function(p){return arguments.length?(y=+p,v):y},v}const te={canvas:{width:1920,height:1080},regions:{problems:{x:300,y:80,clusters:{CL_A:{x:0,y:0,width:400,height:220},CL_B:{x:450,y:0,width:400,height:220},CL_C:{x:200,y:240,width:400,height:220}},standalones:{x:0,y:470,spacing:150}},models:{x:60,y:620,columns:4,spacing:180},mechanisms:{x:800,y:620,columns:3,spacing:180},meta_challenges:{x:1400,y:620,columns:3,spacing:180},foundations:{x:60,y:850,columns:4,spacing:180},implications:{x:800,y:850,columns:5,spacing:150}}};function Fr(e){const t=new Map,n=e.getAllNodes().filter(d=>d.canvasVisible),i=n.filter(d=>d.type==="problem"),s=n.filter(d=>d.type==="cluster"),r=n.filter(d=>d.type==="model"),o=n.filter(d=>d.type==="mechanism"),a=n.filter(d=>d.type==="meta_challenge"),c=n.filter(d=>d.type==="foundation"),l=n.filter(d=>d.type==="implication");return Rr(e,i,t),zr(e,s,t),de(r,t,te.regions.models),de(o,t,te.regions.mechanisms),de(a,t,te.regions.meta_challenges),de(c,t,te.regions.foundations),de(l,t,te.regions.implications),t}function Rr(e,t,n){const{problems:i}=te.regions,{clusters:s,standalones:r}=i,o=new Map,a=[];for(const c of t){const l=e.getEdgesFrom(c.id,"belongs_to")[0];if(l){const d=l.target;o.has(d)||o.set(d,[]),o.get(d).push(c)}else a.push(c)}for(const[c,l]of o){const d=e.getNode(c);if(!d)continue;const h=d.secondaryId,u=s[h];if(!u)continue;const f=i.x+u.x,m=i.y+u.y,g=l.find(L=>L.attributes.role==="hub"),y=l.filter(L=>L.attributes.role==="receiver");g&&n.set(g.id,{x:f+u.width/2,y:m+u.height/2});const v=Math.min(u.width,u.height)/3,w=f+u.width/2,k=m+u.height/2;y.forEach((L,P)=>{const I=P*2*Math.PI/y.length;n.set(L.id,{x:w+v*Math.cos(I),y:k+v*Math.sin(I)})})}a.forEach((c,l)=>{n.set(c.id,{x:i.x+r.x+l*r.spacing,y:i.y+r.y})})}function zr(e,t,n){for(const i of t){const s=e.getEdgesTo(i.id,"belongs_to").map(r=>r.source).map(r=>n.get(r)).filter(r=>r!==void 0);if(s.length>0){const r=s.reduce((a,c)=>a+c.x,0)/s.length,o=s.reduce((a,c)=>a+c.y,0)/s.length;n.set(i.id,{x:r,y:o})}}}function de(e,t,n){e.forEach((i,s)=>{const r=s%n.columns,o=Math.floor(s/n.columns);t.set(i.id,{x:n.x+r*n.spacing,y:n.y+o*n.spacing})})}function Hr(){return te.canvas}function Or(e,t,n){e.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 0 10 10").attr("refX",8).attr("refY",5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto-start-reverse").append("polygon").attr("points","0 0, 10 5, 0 10").attr("fill","var(--edge-structural)"),e.selectAll(".edge").data(t,s=>s.id).join("line").attr("class",s=>{const r=["edge",`edge-${s.type}`];return s.structural&&r.push("edge-structural"),r.join(" ")}).attr("x1",s=>{var r;return((r=n.get(s.source))==null?void 0:r.x)??0}).attr("y1",s=>{var r;return((r=n.get(s.source))==null?void 0:r.y)??0}).attr("x2",s=>{var r;return((r=n.get(s.target))==null?void 0:r.x)??0}).attr("y2",s=>{var r;return((r=n.get(s.target))==null?void 0:r.y)??0}).attr("marker-end",s=>s.directed?"url(#arrowhead)":null)}function qr(e,t,n){const i=t.getNodesByType("cluster").filter(r=>r.canvasVisible),s=30;e.selectAll(".cluster-boundary").data(i,r=>r.id).join("rect").attr("class","cluster-boundary").each(function(r){const o=t.getEdgesTo(r.id,"belongs_to").map(f=>f.source).map(f=>n.get(f)).filter(f=>f!==void 0);if(o.length===0){B(this).attr("display","none");return}const a=o.map(f=>f.x),c=o.map(f=>f.y),l=Math.min(...a)-s,d=Math.max(...a)+s,h=Math.min(...c)-s,u=Math.max(...c)+s;B(this).attr("x",l).attr("y",h).attr("width",d-l).attr("height",u-h)})}const Xe={problem:20,model:20,mechanism:18,meta_challenge:18,foundation:18,implication:16,cluster:0,claim:0,source:0};function Xr(e,t){const n=B("#canvas-container"),i=Hr();n.selectAll("*").remove();const s=n.append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${i.width} ${i.height}`).attr("preserveAspectRatio","xMidYMid meet").attr("class","canvas-root"),r=s.append("g").attr("class","canvas-zoom-root"),o=r.append("g").attr("class","edge-layer"),a=r.append("g").attr("class","cluster-layer"),c=r.append("g").attr("class","node-layer"),l=r.append("g").attr("class","label-layer"),d=Fr(e),h=Dr().scaleExtent([.5,5]).on("zoom",m=>{r.attr("transform",m.transform);const{x:g,y,k:v}=m.transform;t.updateViewport(g,y,v)});s.call(h),s.on("click",m=>{m.target===s.node()&&t.deselectNode()});const u=e.getAllEdges();Or(o,u,d),qr(a,e,d);const f=e.getAllNodes().filter(m=>m.canvasVisible);Vr(c,l,f,d,t),Gr(s,h,d),Yr(t,c)}function Vr(e,t,n,i,s){const r=e.selectAll(".node").data(n,a=>a.id).join("g").attr("class",a=>`node node-${a.type}`).attr("transform",a=>{const c=i.get(a.id);return c?`translate(${c.x}, ${c.y})`:""});r.each(function(a){var l;const c=B(this);a.type==="problem"&&((l=a.attributes)!=null&&l.role)&&c.classed(`node-role-${a.attributes.role}`,!0)}),r.append("circle").attr("r",a=>Xe[a.type]||18),r.on("mouseenter",function(a,c){s.hoverNode(c.id)}).on("mouseleave",function(){s.unhoverNode()}).on("click",function(a,c){a.stopPropagation(),s.selectNode(c.id)});const o=t.selectAll(".node-label-group").data(n,a=>a.id).join("g").attr("class","node-label-group").attr("transform",a=>{const c=i.get(a.id);return c?`translate(${c.x}, ${c.y})`:""});o.append("text").attr("class","node-label").attr("dy",a=>Xe[a.type]+14).text(a=>Wr(a.displayName,40)),o.append("text").attr("class","node-secondary-id").attr("dy",a=>Xe[a.type]+26).text(a=>a.secondaryId)}function Yr(e,t,n){e.subscribe("node:selected",i=>{t.selectAll(".node").classed("selected",function(){return B(this).datum().id===i.selectedNodeId})}),e.subscribe("node:deselected",()=>{t.selectAll(".node").classed("selected",!1)}),e.subscribe("preset:activated",i=>{console.log("Preset activated:",i.activePreset)}),e.subscribe("preset:cleared",()=>{t.selectAll(".node").classed("preset-green",!1).classed("preset-amber",!1).classed("preset-red",!1)})}function Gr(e,t,n){if(n.size===0)return;const i=Array.from(n.values()),s=i.map(I=>I.x),r=i.map(I=>I.y),o=Math.min(...s),a=Math.max(...s),c=Math.min(...r),l=Math.max(...r),d=a-o,h=l-c,u=o+d/2,f=c+h/2,m=e.node();if(!m)return;const g=m.getBoundingClientRect(),y=g.width,v=g.height,w=Math.min(y*.9/d,v*.9/h),k=y/2-u*w,L=v/2-f*w,P=at.translate(k,L).scale(w);e.call(t.transform,P)}function Wr(e,t){return e.length<=t?e:e.substring(0,t-1)+""}function Ur(e,t){const n=document.getElementById("detail-panel");if(!n){console.error("Detail panel element not found");return}t.subscribe("node:selected",i=>{if(i.selectedNodeId){const s=e.getNode(i.selectedNodeId);s&&(Kr(s,e,t,n),n.classList.remove("hidden"))}}),t.subscribe("node:deselected",()=>{n.classList.add("hidden"),n.innerHTML=""})}function Kr(e,t,n,i){i.innerHTML="";const s=document.createElement("div");s.className="detail-panel-content";const r=document.createElement("button");switch(r.className="detail-panel-close",r.innerHTML="&times;",r.setAttribute("aria-label","Close detail panel"),r.onclick=()=>n.deselectNode(),s.appendChild(r),e.type){case"problem":Qr(e,t,n,s);break;case"model":Zr(e,t,n,s);break;case"mechanism":Jr(e,t,n,s);break;case"meta_challenge":jr(e,t,n,s);break;case"foundation":eo(e,t,n,s);break;case"implication":to(e,t,n,s);break;case"claim":no(e,t,n,s);break;case"source":io(e,t,n,s);break;case"cluster":so(e,t,n,s);break}i.appendChild(s)}function Qr(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.scores){const u=E("Scores"),f=document.createElement("div");f.className="scores-grid",[{label:"Frequency",value:a.scores.frequency,max:5},{label:"Differentiation",value:a.scores.differentiation,max:5},{label:"Connectedness",value:a.scores.connectedness,max:5},{label:"Total",value:a.scores.total,max:15}].forEach(g=>{const y=document.createElement("div");y.className="score-item",y.innerHTML=`<span class="score-label">${g.label}</span><span class="score-value">${g.value}/${g.max}</span>`,f.appendChild(y)}),u.appendChild(f),i.appendChild(u)}const c=E("Classification"),l=document.createElement("div");if(l.className="classification-content",a.evidence_tier!==void 0){const u=A(`Tier ${a.evidence_tier}`,"evidence-tier");l.appendChild(u)}if(a.role){const u=A(a.role,"role");l.appendChild(u)}if(a.cluster){const u=t.getNode(a.cluster);if(u){const f=T(u,n);l.appendChild(f)}}c.appendChild(l),i.appendChild(c);const d=t.getEdgesFrom(e.id,"explained_by");if(d.length>0){const u=E("Mechanisms"),f=document.createElement("ul");f.className="entity-list",d.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const h=t.getEdgesFrom(e.id,"evidenced_by");if(h.length>0){const u=E("Claims"),f=document.createElement("ul");f.className="entity-list",h.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li"),v=g.attributes.type||"observation",w=A(v,`claim-type-${v}`);y.appendChild(w),y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}if(a.plain_language){const u=E("Description"),f=document.createElement("p");f.className="description-text",f.textContent=a.plain_language,u.appendChild(f),i.appendChild(u)}}function Zr(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.plain_language){const f=E("Description"),m=document.createElement("p");m.className="description-text",m.textContent=a.plain_language,f.appendChild(m),i.appendChild(f)}if(a.dimensions){const f=E("Dimensions"),m=document.createElement("div");m.className="dimensions-grid",[{label:"Initiation",value:a.dimensions.initiation},{label:"Effort",value:a.dimensions.effort},{label:"Timing",value:a.dimensions.timing},{label:"Continuity",value:a.dimensions.continuity}].forEach(y=>{const v=document.createElement("div");v.className="dimension-item",v.innerHTML=`<span class="dim-label">${y.label}</span><span class="dim-value">${y.value}</span>`,m.appendChild(v)}),f.appendChild(m),i.appendChild(f)}const c=E("Behavioral Characteristics"),l=document.createElement("div");if(l.className="meta-content",a.retention_risk){const f=document.createElement("div");f.innerHTML=`<strong>Retention Risk:</strong> ${a.retention_risk}`,l.appendChild(f)}if(a.habit_burden){const f=document.createElement("div");f.innerHTML=`<strong>Habit Burden:</strong> ${a.habit_burden}`,l.appendChild(f)}c.appendChild(l),i.appendChild(c);const d=t.getEdgesTo(e.id,"compatible_with");if(d.length>0){const f=E("Compatible Problems"),m=document.createElement("ul");m.className="entity-list",d.forEach(g=>{const y=t.getNode(g.source);if(y){const v=document.createElement("li"),w=g.attributes.rating;if(w){const k=A(w,`rating-${w}`);v.appendChild(k)}v.appendChild(T(y,n)),m.appendChild(v)}}),f.appendChild(m),i.appendChild(f)}const h=t.getEdgesFrom(e.id,"vulnerable_to");if(h.length>0){const f=E("Vulnerabilities"),m=document.createElement("ul");m.className="entity-list",h.forEach(g=>{const y=t.getNode(g.target);if(y){const v=document.createElement("li"),w=g.attributes.rating;if(w){const k=A(w,`severity-${w}`);v.appendChild(k)}if(v.appendChild(T(y,n)),g.attributes.narrative){const k=document.createElement("span");k.className="narrative-text",k.textContent=`  ${g.attributes.narrative}`,v.appendChild(k)}m.appendChild(v)}}),f.appendChild(m),i.appendChild(f)}const u=t.getEdgesFrom(e.id,"requires");if(u.length>0){const f=E("Required Foundations"),m=document.createElement("ul");m.className="entity-list",u.forEach(g=>{const y=t.getNode(g.target);if(y){const v=document.createElement("li"),w=g.attributes.strength;if(w){const k=A(w,"foundation-strength");v.appendChild(k)}v.appendChild(T(y,n)),m.appendChild(v)}}),f.appendChild(m),i.appendChild(f)}}function Jr(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.plain_language){const u=E("Description"),f=document.createElement("p");f.className="description-text",f.textContent=a.plain_language,u.appendChild(f),i.appendChild(u)}const c=t.getEdgesTo(e.id,"explained_by");if(c.length>0){const u=E("Affects Problems"),f=document.createElement("ul");f.className="entity-list",c.forEach(m=>{const g=t.getNode(m.source);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const l=t.getEdgesFrom(e.id,"favours");if(l.length>0){const u=E("Favours Models"),f=document.createElement("ul");f.className="entity-list",l.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const d=t.getEdgesFrom(e.id,"disfavours");if(d.length>0){const u=E("Disfavours Models"),f=document.createElement("ul");f.className="entity-list",d.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const h=t.getEdgesFrom(e.id,"evidenced_by");if(h.length>0){const u=E("Evidence"),f=document.createElement("ul");f.className="entity-list",h.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}}function jr(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.severity){const u=A(a.severity,"severity");i.appendChild(u)}if(a.plain_language){const u=E("Description"),f=document.createElement("p");f.className="description-text",f.textContent=a.plain_language,u.appendChild(f),i.appendChild(u)}const c=t.getEdgesTo(e.id,"vulnerable_to");if(c.length>0){const u=E("Affects Models"),f=document.createElement("ul");f.className="entity-list",c.forEach(m=>{const g=t.getNode(m.source);if(g){const y=document.createElement("li"),v=m.attributes.rating;if(v){const w=A(v,`severity-${v}`);y.appendChild(w)}y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const l=t.getEdgesFrom(e.id,"amplifies");if(l.length>0){const u=E("Amplifies"),f=document.createElement("ul");f.className="entity-list",l.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const d=t.getEdgesTo(e.id,"amplifies");if(d.length>0){const u=E("Amplified By"),f=document.createElement("ul");f.className="entity-list",d.forEach(m=>{const g=t.getNode(m.source);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}const h=t.getEdgesFrom(e.id,"evidenced_by");if(h.length>0){const u=E("Claims"),f=document.createElement("ul");f.className="entity-list",h.forEach(m=>{const g=t.getNode(m.target);if(g){const y=document.createElement("li");y.appendChild(T(g,n)),f.appendChild(y)}}),u.appendChild(f),i.appendChild(u)}}function eo(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.purpose){const h=E("Purpose"),u=document.createElement("p");u.className="description-text",u.textContent=a.purpose,h.appendChild(u),i.appendChild(h)}const c=E("Characteristics"),l=document.createElement("div");if(l.className="meta-content",a.complexity){const h=A(a.complexity,"complexity");l.appendChild(h)}if(a.build_or_buy){const h=A(a.build_or_buy,"build-buy");l.appendChild(h)}c.appendChild(l),i.appendChild(c);const d=t.getEdgesTo(e.id,"requires");if(d.length>0){const h=d.filter(f=>f.attributes.strength==="required"),u=d.filter(f=>f.attributes.strength!=="required");if(h.length>0){const f=E("Required By"),m=document.createElement("ul");m.className="entity-list",h.forEach(g=>{const y=t.getNode(g.source);if(y){const v=document.createElement("li");v.appendChild(T(y,n)),m.appendChild(v)}}),f.appendChild(m),i.appendChild(f)}if(u.length>0){const f=E("Optional For"),m=document.createElement("ul");m.className="entity-list",u.forEach(g=>{const y=t.getNode(g.source);if(y){const v=document.createElement("li");v.appendChild(T(y,n)),m.appendChild(v)}}),f.appendChild(m),i.appendChild(f)}}if(a.capabilities&&Array.isArray(a.capabilities)){const h=E("Capabilities"),u=document.createElement("ul");u.className="capabilities-list",a.capabilities.forEach(f=>{const m=document.createElement("li");m.textContent=f,u.appendChild(m)}),h.appendChild(u),i.appendChild(h)}}function to(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.type){const d=A(a.type,"implication-type");i.appendChild(d)}if(a.statement){const d=E("Statement"),h=document.createElement("p");h.className="description-text",h.textContent=a.statement,d.appendChild(h),i.appendChild(d)}const c=t.getEdgesFrom(e.id,"evidenced_by");if(c.length>0){const d=E("Evidence"),h=document.createElement("ul");h.className="entity-list",c.forEach(u=>{const f=t.getNode(u.target);if(f){const m=document.createElement("li");m.appendChild(T(f,n)),h.appendChild(m)}}),d.appendChild(h),i.appendChild(d)}const l=t.getEdgesFrom(e.id,"affects");if(l.length>0){const d=E("Affects"),h=document.createElement("ul");h.className="entity-list",l.forEach(u=>{const f=t.getNode(u.target);if(f){const m=document.createElement("li");m.appendChild(T(f,n)),h.appendChild(m)}}),d.appendChild(h),i.appendChild(d)}}function no(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.secondaryId,s.appendChild(r);const o=e.attributes;if(o.type){const h=A(o.type,`claim-type-${o.type}`);s.appendChild(h)}if(i.appendChild(s),o.statement){const h=E("Statement"),u=document.createElement("p");u.className="description-text",u.textContent=o.statement,h.appendChild(u),i.appendChild(h)}const a=t.getEdgesFrom(e.id,"cites");if(a.length>0){const h=E("Sources"),u=document.createElement("ul");u.className="entity-list",a.forEach(f=>{const m=t.getNode(f.target);if(m){const g=document.createElement("li");g.appendChild(T(m,n)),u.appendChild(g)}}),h.appendChild(u),i.appendChild(h)}const c=t.getEdgesFrom(e.id,"supports");if(c.length>0){const h=E("Supports"),u=document.createElement("ul");u.className="entity-list",c.forEach(f=>{const m=t.getNode(f.target);if(m){const g=document.createElement("li");g.appendChild(T(m,n)),u.appendChild(g)}}),h.appendChild(u),i.appendChild(h)}const l=t.getEdgesTo(e.id,"supports");if(l.length>0){const h=E("Supported By"),u=document.createElement("ul");u.className="entity-list",l.forEach(f=>{const m=t.getNode(f.source);if(m){const g=document.createElement("li");g.appendChild(T(m,n)),u.appendChild(g)}}),h.appendChild(u),i.appendChild(h)}const d=t.getEdgesFrom(e.id,"derived_from");if(d.length>0){const h=E("Depends On"),u=document.createElement("ul");u.className="entity-list",d.forEach(f=>{const m=t.getNode(f.target);if(m){const g=document.createElement("li");g.appendChild(T(m,n)),u.appendChild(g)}}),h.appendChild(u),i.appendChild(h)}}function io(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes,c=E("Classification"),l=document.createElement("div");if(l.className="meta-content",a.type){const h=A(a.type,"source-type");l.appendChild(h)}if(a.evidence_tier){const h=A(a.evidence_tier,"evidence-tier");l.appendChild(h)}if(c.appendChild(l),i.appendChild(c),a.url){const h=E("Link"),u=document.createElement("a");u.href=a.url,u.target="_blank",u.rel="noopener noreferrer",u.className="external-link",u.textContent="View Source",h.appendChild(u),i.appendChild(h)}const d=t.getEdgesTo(e.id,"cites");if(d.length>0){const h=E("Cited In"),u=document.createElement("ul");u.className="entity-list",d.forEach(f=>{const m=t.getNode(f.source);if(m){const g=document.createElement("li");g.appendChild(T(m,n)),u.appendChild(g)}}),h.appendChild(u),i.appendChild(h)}if(a.limitations){const h=E("Limitations"),u=document.createElement("p");u.className="description-text",u.textContent=a.limitations,h.appendChild(u),i.appendChild(h)}}function so(e,t,n,i){const s=document.createElement("div");s.className="detail-header";const r=document.createElement("h2");r.textContent=e.displayName,s.appendChild(r);const o=A(e.secondaryId,"secondary-id");s.appendChild(o),i.appendChild(s);const a=e.attributes;if(a.type){const l=A(a.type,"cluster-type");i.appendChild(l)}if(a.hub){const l=t.getNode(a.hub);if(l){const d=E("Hub Problem"),h=T(l,n);d.appendChild(h),i.appendChild(d)}}const c=t.getEdgesTo(e.id,"belongs_to");if(c.length>0){const l=E("Member Problems"),d=document.createElement("ul");d.className="entity-list",c.forEach(h=>{const u=t.getNode(h.source);if(u){const f=document.createElement("li"),m=h.attributes.role;if(m){const g=A(m,"role");f.appendChild(g)}f.appendChild(T(u,n)),d.appendChild(f)}}),l.appendChild(d),i.appendChild(l)}}function E(e){const t=document.createElement("div");t.className="detail-section";const n=document.createElement("h3");return n.className="section-heading",n.textContent=e,t.appendChild(n),t}function A(e,t){const n=document.createElement("span");return n.className=`badge ${t}`,n.textContent=e,n}function T(e,t){const n=document.createElement("button");return n.className="entity-link",n.textContent=e.displayName,n.type="button",n.onclick=()=>t.selectNode(e.id),n}const ro={name:"evidence_strength",label:"Evidence Strength",parameter:null,nodeRules:[{filter:(e,t)=>{const n=t.getNode(e);return n&&n.attributes.evidence_tier_normalised!==void 0},compute:(e,t)=>{const n=t.getNode(e);if(!n)return{};const i=n.attributes.evidence_tier_normalised;if(i===void 0)return{};const s=["#1D4ED8","#3B82F6","#93C5FD","#DBEAFE"],r=Math.round(i)-1,o=s[Math.max(0,Math.min(3,r))],a=`Tier ${Math.round(i)}`;return{fill:o,badge:a}}}],edgeRules:[],legend:{title:"Evidence Tier",entries:[{label:"Tier 1 (Strongest)",color:"#1D4ED8"},{label:"Tier 2",color:"#3B82F6"},{label:"Tier 3",color:"#93C5FD"},{label:"Tier 4 (Weakest)",color:"#DBEAFE"}]}},oo={name:"model_fit",label:"Model Fit",parameter:{type:"model",label:"Select Model"},nodeRules:[{filter:(e,t)=>{const n=t.getNode(e);return n&&n.type==="problem"},compute:(e,t,n)=>{if(!n)return{};if(!t.getNode(e))return{};const s=t.getEdgeBetween(e,n,"compatible_with");if(!s)return{};const r=s.attributes.rating;return r?{fill:{S:"#16A34A",P:"#F59E0B",X:"#DC2626"}[r]||void 0,badge:r}:{}}},{filter:(e,t)=>!0,compute:(e,t,n)=>!n||e!==n?{}:{border:"#1D4ED8"}}],edgeRules:[{filter:(e,t)=>e.type==="compatible_with",compute:(e,t,n)=>!n||e.target!==n?{visible:!1}:{visible:!0,style:e.attributes.rating==="S"?"solid":"dashed",opacity:1}}],legend:{title:"Compatibility",entries:[{label:"S - Strong fit",color:"#16A34A"},{label:"P - Partial fit",color:"#F59E0B"},{label:"X - Poor fit",color:"#DC2626"}]}},ao={name:"shared_mechanisms",label:"Shared Mechanisms",parameter:null,nodeRules:[{filter:(e,t)=>{const n=t.getNode(e);return n&&n.type==="problem"},compute:(e,t)=>{if(!t.getNode(e))return{};const i=t.getEdgesFrom(e,"explained_by");if(i.length===0)return{};const s=t.getNode(i[0].target);if(!s)return{};const o={"mechanism-MECH01":"#8B5CF6","mechanism-MECH02":"#EC4899","mechanism-MECH03":"#F59E0B","mechanism-MECH04":"#10B981","mechanism-MECH05":"#3B82F6","mechanism-MECH06":"#EF4444"}[s.id]||"#6B7280",a=s.displayName;return{fill:o,badge:a}}}],edgeRules:[{filter:(e,t)=>e.type==="explained_by",compute:(e,t)=>({visible:!0,opacity:1})}],legend:{title:"Mechanisms",entries:[{label:"Problems grouped by mechanism",color:"#6B7280"}]}},co={name:"vulnerability",label:"Vulnerability",parameter:{type:"model",label:"Select Model"},nodeRules:[{filter:(e,t)=>{const n=t.getNode(e);return n&&n.type==="meta_challenge"},compute:(e,t,n)=>{if(!n)return{};if(!t.getNode(e))return{};const s=t.getEdgeBetween(n,e,"vulnerable_to");if(!s)return{};const r=s.attributes.rating;return r?{fill:{H:"#DC2626",M:"#F59E0B",L:"#16A34A"}[r]||void 0,badge:r}:{}}},{filter:(e,t)=>!0,compute:(e,t,n)=>!n||e!==n?{}:{border:"#1D4ED8"}}],edgeRules:[{filter:(e,t)=>e.type==="vulnerable_to",compute:(e,t,n)=>!n||e.source!==n?{visible:!1}:{visible:!0,opacity:1}}],legend:{title:"Vulnerability Rating",entries:[{label:"H - High",color:"#DC2626"},{label:"M - Medium",color:"#F59E0B"},{label:"L - Low",color:"#16A34A"}]}},jt=[ro,oo,ao,co];function lo(e,t){const n=document.getElementById("question-bar");if(!n){console.error("Question bar element not found");return}n.innerHTML="";const i=document.createElement("div");i.className="question-bar-container",jt.forEach(o=>{if(o.parameter){const a=fo(o,e,t);i.appendChild(a)}else{const a=uo(o,t);i.appendChild(a)}});const s=document.createElement("button");s.className="preset-button clear-button",s.textContent="Clear",s.onclick=()=>t.clearPreset(),i.appendChild(s);const r=document.createElement("button");r.className="preset-button reset-button",r.textContent="Reset",r.title="Reset to initial view (clears preset, deselects node, resets viewport)",r.onclick=()=>t.reset(),i.appendChild(r),n.appendChild(i),t.subscribe("preset:activated",o=>{kt(i,o.activePreset,o.presetParam)}),t.subscribe("preset:cleared",()=>{kt(i,null,null)})}function uo(e,t){const n=document.createElement("button");return n.className="preset-button",n.textContent=e.label,n.dataset.preset=e.name,n.onclick=()=>{t.getState().activePreset===e.name?t.clearPreset():t.activatePreset(e.name)},n}function fo(e,t,n){const i=document.createElement("div");i.className="preset-dropdown-wrapper";const s=document.createElement("button");s.className="preset-button",s.textContent=e.label,s.dataset.preset=e.name;const r=document.createElement("div");if(r.className="preset-dropdown hidden",e.parameter.type==="model"){const o=t.getNodesByType("model");o.length===0?(s.disabled=!0,s.title="No models available"):o.forEach(a=>{const c=document.createElement("button");c.className="dropdown-option",c.textContent=a.displayName,c.dataset.modelId=a.id,c.onclick=l=>{l.stopPropagation();const d=n.getState();d.activePreset===e.name&&d.presetParam===a.id?n.clearPreset():n.activatePreset(e.name,a.id),r.classList.add("hidden")},r.appendChild(c)})}return s.onclick=o=>{o.stopPropagation(),n.getState().activePreset===e.name?(n.clearPreset(),r.classList.add("hidden")):(document.querySelectorAll(".preset-dropdown").forEach(c=>{c!==r&&c.classList.add("hidden")}),r.classList.toggle("hidden"))},i.appendChild(s),i.appendChild(r),document.addEventListener("click",o=>{i.contains(o.target)||r.classList.add("hidden")}),i}function kt(e,t,n){e.querySelectorAll(".preset-button").forEach(i=>{const s=i,r=s.dataset.preset;if(r)if(t===r){s.classList.add("active");const o=s.parentElement;if(o&&o.classList.contains("preset-dropdown-wrapper")){const a=o.querySelector(".preset-dropdown");a&&a.querySelectorAll(".dropdown-option").forEach(c=>{const l=c;l.dataset.modelId===n?l.classList.add("active"):l.classList.remove("active")})}}else s.classList.remove("active")})}function ho(e,t){const n=document.getElementById("search-overlay");if(!n){console.error("Search overlay element not found");return}let i=null,s=null;t.subscribe("search:toggled",c=>{c.searchOpen?r():o()});function r(){if(n.classList.remove("hidden"),!i){const c=document.createElement("div");c.className="search-box",i=document.createElement("input"),i.type="text",i.className="search-input",i.placeholder="Search entities...",i.setAttribute("aria-label","Search entities"),s=document.createElement("div"),s.className="search-results",c.appendChild(i),c.appendChild(s),n.appendChild(c),i.addEventListener("input",l=>{const d=l.target.value;a(d)}),i.addEventListener("keydown",l=>{l.key==="Escape"&&(l.preventDefault(),t.escape())})}i&&(i.value="",i.focus()),s&&(s.innerHTML="")}function o(){n.classList.add("hidden")}function a(c){if(!s||(s.innerHTML="",c.length===0))return;const l=e.getAllNodes(),d=c.toLowerCase(),h=l.filter(y=>{const v=y.displayName.toLowerCase().includes(d),w=y.secondaryId.toLowerCase().includes(d);return v||w}),u=new Map;h.forEach(y=>{u.has(y.type)||u.set(y.type,[]),u.get(y.type).push(y)});let f=0;const m=10,g=["problem","model","mechanism","meta_challenge","foundation","implication","claim","source","cluster"];for(const y of g){if(f>=m)break;const v=u.get(y);if(!v||v.length===0)continue;const w=document.createElement("div");w.className="search-type-group";const k=document.createElement("div");k.className="search-type-header",k.textContent=mo(y),w.appendChild(k);const L=document.createElement("div");L.className="search-type-results";for(const P of v){if(f>=m)break;const I=po(P,t);L.appendChild(I),f++}w.appendChild(L),s.appendChild(w)}if(f===0){const y=document.createElement("div");y.className="search-no-results",y.textContent="No results found",s.appendChild(y)}}n.addEventListener("click",c=>{c.target===n&&t.escape()})}function po(e,t){const n=document.createElement("button");n.className="search-result-item",e.canvasVisible||n.classList.add("off-canvas");const i=document.createElement("span");i.className="result-name",i.textContent=e.displayName;const s=document.createElement("span");if(s.className="result-id",s.textContent=e.secondaryId,n.appendChild(i),n.appendChild(s),e.canvasVisible)n.onclick=()=>{t.selectNode(e.id),t.escape()};else{n.disabled=!0,n.title="This entity is not visible on canvas";const r=document.createElement("span");r.className="off-canvas-label",r.textContent="Off canvas",n.appendChild(r)}return n}function mo(e){return{problem:"Problems",model:"Models",mechanism:"Mechanisms",meta_challenge:"Meta-Challenges",foundation:"Foundations",implication:"Implications",claim:"Claims",source:"Sources",cluster:"Clusters"}[e]||e}function go(e,t){const n=document.createElement("div");n.className="tooltip hidden",n.id="graph-tooltip",document.body.appendChild(n);let i=null;const s=300;t.subscribe("node:hovered",r=>{if(r.hoveredNodeId){const o=e.getNode(r.hoveredNodeId);o&&(i=window.setTimeout(()=>{yo(o,n)},s))}}),t.subscribe("node:unhovered",()=>{i&&(clearTimeout(i),i=null),vo(n)}),document.addEventListener("mousemove",r=>{n.classList.contains("hidden")||bo(n,r.clientX,r.clientY)})}function yo(e,t){switch(t.innerHTML="",e.type){case"problem":xo(e,t);break;case"model":_o(e,t);break;case"mechanism":wo(e,t);break;case"meta_challenge":Co(e,t);break;case"foundation":Eo(e,t);break;case"implication":No(e,t);break;case"claim":So(e,t);break;case"source":ko(e,t);break;case"cluster":Mo(e,t);break;default:t.innerHTML=`<strong>${e.displayName}</strong>`}t.classList.remove("hidden")}function vo(e){e.classList.add("hidden")}function bo(e,t,n){const s=window.innerWidth,r=window.innerHeight,o=e.getBoundingClientRect();let a=t+15,c=n+15;a+o.width>s&&(a=t-o.width-15),c+o.height>r&&(c=n-o.height-15),e.style.left=`${a}px`,e.style.top=`${c}px`}function xo(e,t){const n=e.attributes,i=document.createElement("div");if(i.className="tooltip-name",i.textContent=e.displayName,t.appendChild(i),n.scores){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Total Score: ${n.scores.total}/15`,t.appendChild(s)}if(n.evidence_tier!==void 0){const s=document.createElement("div");s.className="tooltip-field";const r=Math.round(n.evidence_tier);s.textContent=`Evidence: Tier ${r}`,t.appendChild(s)}if(n.cluster){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Cluster: ${n.cluster}`,t.appendChild(s)}if(n.role){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Role: ${n.role}`,t.appendChild(s)}}function _o(e,t){const n=e.attributes,i=document.createElement("div");if(i.className="tooltip-name",i.textContent=e.displayName,t.appendChild(i),n.dimensions&&n.dimensions.initiation){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Initiation: ${n.dimensions.initiation}`,t.appendChild(s)}if(n.habit_burden){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Habit Burden: ${n.habit_burden}`,t.appendChild(s)}}function wo(e,t){const n=document.createElement("div");n.className="tooltip-name",n.textContent=e.displayName,t.appendChild(n)}function Co(e,t){const n=document.createElement("div");n.className="tooltip-name",n.textContent=e.displayName,t.appendChild(n)}function Eo(e,t){const n=e.attributes,i=document.createElement("div");if(i.className="tooltip-name",i.textContent=e.displayName,t.appendChild(i),n.complexity){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Complexity: ${n.complexity}`,t.appendChild(s)}if(n.build_or_buy){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`${n.build_or_buy}`,t.appendChild(s)}}function No(e,t){const n=e.attributes,i=document.createElement("div");if(i.className="tooltip-name",i.textContent=e.displayName,t.appendChild(i),n.type){const s=document.createElement("div");s.className="tooltip-field",s.textContent=`Type: ${n.type}`,t.appendChild(s)}}function So(e,t){const n=e.attributes;if(n.statement){const i=document.createElement("div");i.className="tooltip-statement",i.textContent=n.statement,t.appendChild(i)}else{const i=document.createElement("div");i.className="tooltip-name",i.textContent=e.displayName,t.appendChild(i)}if(n.type){const i=document.createElement("div");i.className="tooltip-field",i.textContent=`Type: ${n.type}`,t.appendChild(i)}}function ko(e,t){const n=document.createElement("div");n.className="tooltip-name",n.textContent=e.displayName,t.appendChild(n)}function Mo(e,t){const n=document.createElement("div");n.className="tooltip-name",n.textContent=e.displayName,t.appendChild(n)}function To(e,t){const n=document.getElementById("mode-indicator");if(!n){console.error("Mode indicator element not found");return}t.subscribe("mode:changed",s=>{Ve(n,s.mode,s.selectedNodeId,e)}),t.subscribe("node:selected",s=>{Ve(n,s.mode,s.selectedNodeId,e)});const i=t.getState();Ve(n,i.mode,i.selectedNodeId,e)}function Ve(e,t,n,i){switch(e.className="mode-indicator",t){case"BROWSE":e.textContent="Exploring",e.classList.add("mode-browse");break;case"DETAIL":if(n){const s=i.getNode(n);s?(e.textContent=`Viewing: ${s.displayName}`,e.classList.add("mode-detail")):(e.textContent="Exploring",e.classList.add("mode-browse"))}else e.textContent="Exploring",e.classList.add("mode-browse");break;case"REFOCUS":e.textContent="Focused",e.classList.add("mode-refocus");break;default:e.textContent="Exploring",e.classList.add("mode-browse")}}function en(e,t,n){if(!e)return{nodeOverrides:new Map,edgeOverrides:new Map,legend:null};const i=jt.find(l=>l.name===e);if(!i)return console.warn(`Preset not found: ${e}`),{nodeOverrides:new Map,edgeOverrides:new Map,legend:null};const s=new Map,r=new Map,o=n.getAllNodes();for(const l of o)for(const d of i.nodeRules)if(d.filter(l.id,n)){const h=d.compute(l.id,n,t||void 0);if(Object.keys(h).length>0){const u=s.get(l.id)||{};s.set(l.id,{...u,...h})}}const a=n.getAllEdges();for(const l of a)for(const d of i.edgeRules)if(d.filter(l,n)){const h=d.compute(l,n,t||void 0);if(Object.keys(h).length>0){const u=r.get(l.id)||{};r.set(l.id,{...u,...h})}}let c=i.legend;if(e==="shared_mechanisms"){const l=new Map;for(const d of o)if(d.type==="problem"){const h=s.get(d.id);h&&h.fill&&h.badge&&(l.has(h.badge)||l.set(h.badge,{name:h.badge,color:h.fill}))}l.size>0&&(c={title:"Mechanisms",entries:Array.from(l.values()).map(d=>({label:d.name,color:d.color}))})}return{nodeOverrides:s,edgeOverrides:r,legend:c}}function Ao(e,t){const n=document.getElementById("legend");if(!n){console.error("Legend element not found");return}t.subscribe("preset:activated",i=>{const s=en(i.activePreset,i.presetParam,e);s.legend?(Lo(n,s.legend),n.classList.remove("hidden")):n.classList.add("hidden")}),t.subscribe("preset:cleared",()=>{n.classList.add("hidden"),n.innerHTML=""})}function Lo(e,t){e.innerHTML="";const n=document.createElement("div");n.className="legend-container";const i=document.createElement("div");i.className="legend-title",i.textContent=t.title,n.appendChild(i);const s=document.createElement("div");s.className="legend-entries",t.entries.forEach(r=>{const o=document.createElement("div");o.className="legend-item";const a=document.createElement("div");a.className="legend-swatch",a.style.backgroundColor=r.color,a.setAttribute("aria-label",r.label);const c=document.createElement("span");c.className="legend-label",c.textContent=r.label,o.appendChild(a),o.appendChild(c),s.appendChild(o)}),n.appendChild(s),e.appendChild(n)}async function $o(){console.log("ADHD Navigator loading...");const e=await fetch("/adhd-product-research/data/graph.json");if(!e.ok){console.error("Failed to load graph data:",e.status);return}const t=await e.json();console.log(`Loaded graph: ${t.metadata.nodeCount} nodes, ${t.metadata.edgeCount} edges`),t.metadata.warnings.length>0&&console.warn(`Graph has ${t.metadata.warnings.length} warnings`);const n=new an(t),i=new cn;document.addEventListener("keydown",s=>{s.key==="Escape"&&i.escape(),(s.ctrlKey||s.metaKey)&&s.key==="k"&&(s.preventDefault(),i.toggleSearch())}),Xr(n,i),Ur(n,i),lo(n,i),ho(n,i),go(n,i),To(n,i),Ao(n,i),Io(n,i),window.__graph=n,window.__store=i,console.log("ADHD Navigator ready.")}function Io(e,t){t.subscribe("preset:activated",n=>{const i=en(n.activePreset,n.presetParam,e),s=B(".node-layer"),r=B(".edge-layer");s.selectAll(".node").each(function(){const o=B(this),a=o.datum();if(!a)return;const c=i.nodeOverrides.get(a.id);if(o.select("circle").style("fill",null).style("stroke",null).style("opacity",null),o.classed("preset-green",!1).classed("preset-amber",!1).classed("preset-red",!1),o.selectAll(".preset-badge").remove(),c){if(c.fill&&o.select("circle").style("fill",c.fill),c.border&&o.select("circle").style("stroke",c.border).style("stroke-width","3px"),c.opacity!==void 0&&o.style("opacity",c.opacity),c.badge){const l=o.select("circle"),d=parseFloat(l.attr("r"))||18;o.append("text").attr("class","preset-badge").attr("dy",-d-6).attr("text-anchor","middle").attr("font-size","10px").attr("font-weight","600").attr("fill",c.fill||"#333").text(c.badge)}}else o.style("opacity",.3)}),r.selectAll(".edge").each(function(){const o=B(this),a=o.datum();if(!a)return;const c=i.edgeOverrides.get(a.id);c&&(c.visible===!1?o.style("display","none"):(o.style("display",null),c.color&&o.style("stroke",c.color),c.width&&o.style("stroke-width",`${c.width}px`),c.opacity!==void 0&&o.style("opacity",c.opacity),c.style==="dashed"?o.style("stroke-dasharray","5,3"):c.style==="dotted"?o.style("stroke-dasharray","2,2"):o.style("stroke-dasharray",null)))})}),t.subscribe("preset:cleared",()=>{const n=B(".node-layer"),i=B(".edge-layer");n.selectAll(".node").each(function(){const s=B(this);s.select("circle").style("fill",null).style("stroke",null).style("stroke-width",null).style("opacity",null),s.style("opacity",null),s.classed("preset-green",!1).classed("preset-amber",!1).classed("preset-red",!1),s.selectAll(".preset-badge").remove()}),i.selectAll(".edge").each(function(){B(this).style("display",null).style("stroke",null).style("stroke-width",null).style("stroke-dasharray",null).style("opacity",null)})})}$o();
